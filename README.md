# EventHub
- Maven project
- Java 21
- Spring Boot 3
### Описание
Приложение позволяет пользователям делиться информацией об интересных событиях и находить компанию для участия в них,
представляет собой афишу, в которой можно предложить какое-либо событие от выставки до похода в кино 
и собрать компанию для участия в нём. 
### Структура приложения
Приложение включает в себя **два сервиса**, 
и для его полноценного функционирования необходимо, 
чтобы *оба* сервиса были запущены.
### Основной сервис 
Содержит всё необходимое для работы продукта. 
API основного сервиса разделена на три части:
- **публичная** доступна без регистрации любому пользователю сети; 
- **закрытая** будет доступна только авторизованным пользователям; 
- **административная** — для администраторов сервиса.
#### Эндпоинты основного серсвиса
#### Категории
1. **POST `/admin/categories`**
  - **Описание:** Добавление новой категории (имя категории должно быть уникальным).
  - **Ответы:** `201` (Категория добавлена), `400` (Некорректный запрос), `409` (Конфликт данных).

2. **DELETE `/admin/categories/{catId}`**
  - **Описание:** Удаление категории (должна быть не связана с событиями).
  - **Ответы:** `204` (Категория удалена), `404` (Категория не найдена), `409` (Конфликт данных).

3. **PATCH `/admin/categories/{catId}`**
  - **Описание:** Изменение категории (имя должно быть уникальным).
  - **Ответы:** `200` (Категория изменена), `404` (Категория не найдена), `409` (Конфликт данных).

#### События
1. **GET `/events`**
  - **Описание:** Получение списка событий (с фильтрацией и сортировкой).
  - **Ответы:** `200` (Успех), `400` (Некорректный запрос).

2. **POST `/admin/events`**
  - **Описание:** Создание нового события.
  - **Ответы:** `201` (Событие создано), `400` (Некорректный запрос).

3. **GET `/admin/events/{eventId}`**
  - **Описание:** Получение подробной информации о событии.
  - **Ответы:** `200` (Успех), `404` (Событие не найдено).

4. **PATCH `/admin/events/{eventId}`**
  - **Описание:** Изменение данных о событии.
  - **Ответы:** `200` (Событие изменено), `404` (Событие не найдено).

5. **DELETE `/admin/events/{eventId}`**
  - **Описание:** Удаление события.
  - **Ответы:** `204` (Событие удалено), `404` (Событие не найдено).

#### Подборки событий
1. **GET `/admin/compilations`**
  - **Описание:** Получение списка подборок событий.
  - **Ответы:** `200` (Успех).

2. **POST `/admin/compilations`**
  - **Описание:** Создание новой подборки.
  - **Ответы:** `201` (Подборка создана), `400` (Некорректный запрос).

3. **DELETE `/admin/compilations/{compId}`**
  - **Описание:** Удаление подборки.
  - **Ответы:** `204` (Подборка удалена), `404` (Подборка не найдена).

4. **PATCH `/admin/compilations/{compId}`**
  - **Описание:** Изменение данных о подборке.
  - **Ответы:** `200` (Подборка изменена), `404` (Подборка не найдена).

#### Запросы на участие
1. **GET `/requests`**
  - **Описание:** Получение списка запросов текущего пользователя на участие.
  - **Ответы:** `200` (Успех).

2. **PATCH `/requests/{reqId}/status`**
  - **Описание:** Изменение статуса запроса на участие.
  - **Ответы:** `200` (Статус изменен), `404` (Запрос не найден).

#### Пользователи
1. **GET `/admin/users`**
  - **Описание:** Получение списка пользователей.
  - **Ответы:** `200` (Успех).

2. **POST `/admin/users`**
  - **Описание:** Добавление нового пользователя.
  - **Ответы:** `201` (Пользователь добавлен), `400` (Некорректный запрос).

3. **DELETE `/admin/users/{userId}`**
  - **Описание:** Удаление пользователя.
  - **Ответы:** `204` (Пользователь удален), `404` (Пользователь не найден).

4. **PATCH `/admin/users/{userId}`**
  - **Описание:** Изменение данных пользователя.
  - **Ответы:** `200` (Данные изменены), `404` (Пользователь не найден).

### Сервис статистики 
Хранит количество просмотров. 
Позволяет делать различные выборки для анализа работы приложения. 
Он собирает информацию:
- о количестве обращений пользователей к спискам событий, 
- о количестве запросов к подробной информации о событии. 
На основе этой информации формируется статистика о работе приложения.

##### Эндпоинты сервиса статистики:
1. **POST `/hit`** 
  - **Описание:** Сохранение информации о том, что на URI конкретного сервиса был отправлен запрос пользователем. Название сервиса, URI и IP пользователя указаны в теле запроса.
  - **Запрос:** Тело запроса: Объект EndpointHit (содержит id, app, uri, ip, timestamp)
  - **Ответ:** Код: 201 Описание: Информация сохранена
2. **GET `/stats`** 
  - **Описание:** Получение статистики по посещениям. 
  - **Параметры запроса**
    - start: Дата и время начала диапазона в формате "yyyy-MM-dd HH:mm" (обязательный)
    - end: Дата и время конца диапазона в формате "yyyy-MM-dd HH:mm" (обязательный)
    - uris: Список URI для которых нужно выгрузить статистику (необязательный)
    - unique: Учитывать только уникальные посещения, только с уникальным IP
    (необязательный, по умолчанию false)
  - **Ответ:** Код: 200, Описание: Статистика собрана. Тело ответа: Массив объектов ViewStats (содержит app, uri, hits)
## Спецификации
- [основной сервис](./ewm-main-service-spec.json)
- [сервис статистики](./ewm-stats-service-spec.json)
## Последние изменения
### ADD RATINGS
#### ссылка на Pull Request:
https://github.com/aDukeFan/java-explore-with-me/pull/3
#### Появилась новая сущность - Rating, она содержит в себе негативную или позитивную оценку события.
Оставить позитивную или негативную оценку может только пользователь:
- который принимает участие в событии, но не является его организатором,
- при условии, что на момент оценки время события уже наступило,
- пользователь может поставить оценку одному событию единожды,
- пользователь может изменить оценку, ограничений по количеству изменений нет.

Сущность Event теперь имеет список позитивных и негативных оценок:
- DTO классы Event дополнены полями Likes и Dislikes, 
которые представляют собой сумму позитивных и негативных оценок соответственно,
- сортировка событий по рейтингу определяется разностью сумм позитивных и негативных оценок,
- события можно сортировать как от меньшего рейтинга к большему, так и наоборот.

### Появился рейтинг пользователей - Rank
- Рейтинг пользователя, который не инициировал события, 
или события которого не были оценены, по умолчанию равен нулю.
- Рейтинг пользователя, представляет собой процент событий, созданных пользователем, 
сумма позитивных оценок которых превышает сумму негативных оценок
### Новые эндпоинты 

1. **POST `users/{userId}/event/{eventId}/rating`**
    - **Описание:** Добавление рейтинга событию (позитивного или негативного) для события. 
   Пользователь может оставить оценку событию, в котором он участвовал.
    - **Параметры:**
        - `userId` (path) - Идентификатор пользователя, оставляющего рейтинг.
        - `eventId` (path) - Идентификатор события, которому присваивается рейтинг.
        - `isLike` (query) - Булево значение, указывающее на позитивную (`true`) или негативную (`false`) оценку.
    - **Ответ для корректного запроса**
        - `201 Created` - Рейтинг успешно добавлен.

2. **PATCH `users/{userId}/event/{eventId}/rating`**
    - **Описание:** Обновление существующего рейтинга для события. 
   Пользователь может изменить свою оценку на противоположную.
    - **Параметры:**
        - `userId` (path) - Идентификатор пользователя, который обновляет рейтинг.
        - `eventId` (path) - Идентификатор события, для которого обновляется рейтинг.
        - `isLike` (query) - Булево значение, указывающее на новую оценку (позитивная или негативная).
    - **Ответ для корректного запроса**
        - `200 OK` - Рейтинг успешно обновлен.
